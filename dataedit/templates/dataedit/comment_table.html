{% extends "dataedit/base.html" %}

{% block data_content %}

{% load staticfiles %}
{% load bootstrap3 %}
<h3>{{schema}}.{{table}}</h3>

{% include 'dataedit/taggable_setting.html' with table=table schema=schema selected=tags %}
<hr>

<link rel="stylesheet" href="{% static 'dataedit/dataedit.css' %}">
<script type="text/javascript" src="{% static 'dataedit/views.js' %}"></script>

<!-- vendor css -->
<link href="{% static 'dataedit/recline/vendor/leaflet/0.7.3/leaflet.css' %}" rel="stylesheet">
<link href="{% static 'dataedit/recline/vendor/leaflet.markercluster/MarkerCluster.css' %}" rel="stylesheet">
<link href="{% static 'dataedit/recline/vendor/leaflet.markercluster/MarkerCluster.Default.css' %}" rel=
  "stylesheet">
<link rel="stylesheet" href="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.grid.css' %}">

<!-- recline css -->
<link href="{% static 'dataedit/recline/css/map.css' %}" rel="stylesheet">

<link href="{% static 'dataedit/recline/css/multiview.css' %}" rel="stylesheet">
<link href="{% static 'dataedit/recline/css/slickgrid.css' %}"rel="stylesheet">
<link href="{% static 'dataedit/recline/css/flot.css' %}" rel="stylesheet">

<!-- Vendor JS - general dependencies -->
<script src="{% static 'dataedit/recline/vendor/jquery/1.7.1/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/underscore/1.4.4/underscore.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/backbone/1.0.0/backbone.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/mustache/0.5.0-dev/mustache.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/bootstrap/3.2.0/js/bootstrap.js' %}" type="text/javascript"></script>

<!-- Vendor JS - view dependencies -->
<script src="{% static 'dataedit/recline/vendor/leaflet/0.7.3/leaflet.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/leaflet.markercluster/leaflet.markercluster.js' %}" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/flot/jquery.flot.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/flot/jquery.flot.time.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/moment/2.0.0/moment.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/jquery-ui-1.8.16.custom.min.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/jquery.event.drag-2.2.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.core.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.formatters.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.editors.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.grid.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/plugins/slick.rowselectionmodel.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/plugins/slick.rowmovemanager.js' %}"></script>

<!-- Recline JS (combined distribution, all views) -->
<script type="text/javascript" src="{% static 'dataedit/recline/dist/recline.js' %}"></script>


<script type="text/javascript" src="{% static 'dataedit/editors.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/backend.js' %}"></script>


<script type="text/javascript">
    function add_assumption_input(id){
        var $container = $("</div>");
        $container.addClass("form-group");


        $label = $("</label>");
        $label.attr({
            for: 'assumption_'+id,
        });
        $label.innerHTML = "Assumption type:";
        $label.appendTo($container);

        $assumption = $("</input>");
        $assumption.attr({
            type: 'textarea',
            id: 'assumption_'+id
        });
        $assumption.appendTo($container);

        $container.appendTo($("#assumptions"));
    }
</script>

<div class="container">
  <style type="text/css">
    .recline-slickgrid {
      min-height: 700px;
    }

    .changelog {
      display: none;
      border-bottom: 1px solid #ccc;
      margin-bottom: 10px;
    }
  </style>


        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    Comments
                </h4>
            </div>
            <div>
                <div class="comment-explorer-here"></div>
            </div>

        </div>

    <div class="well">
        <span class="lead">Commit your changes</span><br>
        Your changes will not be written to the actual OpenEnergyDatabase but an
        additional schema. <br>
        New or changed data has to pass a validation process before it
        is publicated in the next revision. <br>
         <form>
            <div class="form-group">
                <label for="method">Method:</label>
                <input type="text" class="form-control" id="method">
            </div>
            <div class="form-group">
                <label for="origin">Origin:</label>
                <input type="text" class="form-control" id="origin">
            </div>
            <div class="form-group">
                <label for="origin">Assumptions:</label>
                <div>
                    <div id="assumptions"></div>
                    <button onclick="add_assumption_input()" class="btn btn-add btn-circle glyphicon glyphicon-plus"></button>
                </div>
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
        </form>
    </div>

  <div style="clear: both;"></div>
    Data is displayed using <a href="http://okfnlabs.org/recline/">recline.js</a>
</div>

<script type="text/javascript">

var data_record = {}
var unchecked_record = {}
var comment_record = {}

function build_views(unchecked){

    var comment_dataset = new recline.Model.Dataset({
            table: '_{{table}}_cor',
            schema: '_{{schema}}',
            backend: 'OEP',
            has_row_comments: false
    });



    comment_dataset.fetch().done(function(dataset) {
        plot_view(dataset,
            true,
            $('.comment-explorer-here'), comment_record)
    });

    comment_dataset.records.bind('add', function(){alert(args);});

    $('#savebutton').bind('click',
    function() {
        changes = {
            creates: dataset_main._changes.creates,
            updates:    dataset_main.records.filter(
                function(el){return !(jQuery.isEmptyObject(el.changed));}),
            deletes: dataset_main._changes.deletes
        };

        dataset_main.backend.save(changes, dataset_main);
    });
}

build_views(false);



</script>


{% endblock %}
